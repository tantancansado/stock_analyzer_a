qj<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåü Super Opportunities 5D | Full Analysis</title>
    <style>
        :root {
            --glass-primary: rgba(99, 102, 241, 0.8);
            --glass-secondary: rgba(139, 92, 246, 0.7);
            --glass-accent: rgba(59, 130, 246, 0.9);
            --glass-gold: rgba(255, 215, 0, 0.3);
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --accent-gold: #ffd700;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: #020617;
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container { max-width: 2200px; margin: 0 auto; }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffd700, #ff8c00, #ff1493, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .hero-section {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.1));
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-box {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--glass-accent), var(--glass-primary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .nav-link:hover { background: rgba(255,255,255,0.08); color: var(--text-primary); }

        /* Filters */
        .filters-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 0.5rem 1rem;
        }

        .filter-group label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .filter-group select,
        .filter-group input[type="range"] {
            background: transparent;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .filter-group input[type="checkbox"] {
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        #scoreValue {
            color: var(--accent-gold);
            font-weight: 700;
            min-width: 30px;
        }

        .result-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-left: auto;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            padding: 0.8rem 1rem;
            text-align: left;
            border-bottom: 2px solid var(--glass-border);
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
        }

        th.sortable:hover { color: var(--accent-gold); }
        th.active-sort { color: var(--accent-gold); }
        .sort-icon { font-size: 0.8em; opacity: 0.6; }

        td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            font-size: 0.9rem;
        }

        tr:hover { background: rgba(255, 255, 255, 0.02); }

        .ticker {
            font-weight: 700;
            font-size: 1rem;
            color: #60a5fa;
        }

        .score {
            font-weight: 800;
            font-size: 1.1rem;
        }

        .legendary { color: #ffd700; }
        .epic { color: #c084fc; }
        .excellent { color: #4ade80; }
        .good { color: #60a5fa; }
        .moderate { color: var(--text-secondary); }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sector-improving { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
        .sector-declining { background: rgba(248, 113, 113, 0.2); color: #f87171; }
        .sector-stable { background: rgba(96, 165, 250, 0.2); color: #60a5fa; }

        .text-success { color: #4ade80; }
        .text-info { color: #60a5fa; }
        .text-danger { color: #f87171; }

        .dim-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(255,255,255,0.06);
        }

        .whale-info {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .methodology {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="glass-card hero-section">
            <h1>üåü SUPER OPPORTUNITIES 5D</h1>
            <div class="subtitle">5D Analysis: VCP + Insiders + Sector Enhancement + Institutional + Fundamentals</div>
            <div class="subtitle" style="font-size: 0.9rem; margin-top: 1rem;">
                üìÖ Actualizado: <span id="lastUpdate">Loading...</span>
            </div>

            <div style="text-align: center; margin-top: 1.5rem;">
                <a href="index.html" class="nav-link">üè† Dashboard</a>
                <a href="institutional_tracker.html" class="nav-link">üèõÔ∏è Institutional Tracker</a>
                <a href="vcp_scanner_results.html" class="nav-link">üìä VCP Scanner</a>
                <a href="dj_sectorial.html" class="nav-link">üìä DJ Sectorial</a>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="totalOpps">-</div>
                    <div class="stat-label">Total Universe</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="qualityCount">-</div>
                    <div class="stat-label">Quality (score ‚â•55)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="legendaryCount">-</div>
                    <div class="stat-label">‚≠ê‚≠ê‚≠ê‚≠ê LEGENDARY</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="epicCount">-</div>
                    <div class="stat-label">‚≠ê‚≠ê‚≠ê √âPICAS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="withUpside">-</div>
                    <div class="stat-label">‚Üë Con Upside</div>
                </div>
            </div>
        </div>

        <div class="glass-card">
            <div class="filters-row">
                <div class="filter-group">
                    <label>Score m√≠nimo:</label>
                    <input type="range" id="scoreFilter" min="0" max="100" value="55" step="5">
                    <span id="scoreValue">55</span>
                </div>
                <div class="filter-group">
                    <input type="checkbox" id="upsideFilter" checked>
                    <label for="upsideFilter">Solo upside positivo</label>
                </div>
                <div class="filter-group">
                    <label>Mostrar:</label>
                    <select id="limitFilter">
                        <option value="25">Top 25</option>
                        <option value="50">Top 50</option>
                        <option value="100">Top 100</option>
                        <option value="0">Todos</option>
                    </select>
                </div>
                <div class="result-count" id="resultCount"></div>
            </div>

            <div style="overflow-x: auto;">
                <table id="opportunitiesTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-col="rank"># <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable" data-col="ticker">Ticker <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable active-sort" data-col="score">5D Score <span class="sort-icon">‚Üì</span></th>
                            <th>Tier</th>
                            <th class="sortable" data-col="vcp">VCP <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable" data-col="insiders">Insiders <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable" data-col="sector">Sector <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable" data-col="institutional">Institutional <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable" data-col="upside">Target / Upside <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable" data-col="whales">Whales <span class="sort-icon">‚Üï</span></th>
                            <th class="sortable" data-col="earnings">Earnings <span class="sort-icon">‚Üï</span></th>
                        </tr>
                    </thead>
                    <tbody id="opportunitiesBody">
                        <tr>
                            <td colspan="11" style="text-align: center; padding: 2rem;">Loading opportunities...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let sortState = { col: 'score', dir: 'desc' };

        function getScore(opp) {
            return parseFloat(opp.super_score_5d || opp.super_score_4d) || 0;
        }

        function getUpside(opp) {
            const v = parseFloat(opp.upside_percent);
            return isNaN(v) ? null : v;
        }

        async function loadOpportunities() {
            try {
                const csvPaths = [
                    'super_opportunities_5d_complete_with_earnings.csv',
                    'super_opportunities_5d_complete.csv',
                    'super_opportunities_4d_complete_with_earnings.csv',
                    'super_opportunities_4d_complete.csv'
                ];

                let csvText = null;
                for (const path of csvPaths) {
                    try {
                        const r = await fetch(path);
                        if (r.ok) { csvText = await r.text(); break; }
                    } catch (e) {
                        console.warn('Could not load', path);
                    }
                }

                if (!csvText) throw new Error('No CSV found');

                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                allData = lines.slice(1).map(line => {
                    const values = parseCSVLine(line);
                    const obj = {};
                    headers.forEach((header, i) => {
                        obj[header.trim()] = values[i] ? values[i].trim() : '';
                    });
                    return obj;
                });

                const legendary = allData.filter(d => getScore(d) >= 85);
                const epic = allData.filter(d => getScore(d) >= 75 && getScore(d) < 85);
                const quality = allData.filter(d => getScore(d) >= 55);
                const withUpside = allData.filter(d => {
                    const u = getUpside(d);
                    return u !== null && u > 0;
                });

                document.getElementById('totalOpps').textContent = allData.length;
                document.getElementById('qualityCount').textContent = quality.length;
                document.getElementById('legendaryCount').textContent = legendary.length;
                document.getElementById('epicCount').textContent = epic.length;
                document.getElementById('withUpside').textContent = withUpside.length;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('es-ES', {
                    month: 'short', day: 'numeric', year: 'numeric'
                });

                renderTable();

            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('opportunitiesBody').innerHTML = `
                    <tr><td colspan="11" style="text-align: center; color: var(--text-secondary);">‚ùå Error loading data: ${error.message}</td></tr>
                `;
            }
        }

        function getFilterValues() {
            return {
                minScore: parseInt(document.getElementById('scoreFilter').value),
                upsideOnly: document.getElementById('upsideFilter').checked,
                limit: parseInt(document.getElementById('limitFilter').value)
            };
        }

        function renderTable() {
            const { minScore, upsideOnly, limit } = getFilterValues();

            let filtered = allData.filter(opp => {
                if (getScore(opp) < minScore) return false;
                if (upsideOnly) {
                    const upside = getUpside(opp);
                    if (upside !== null && upside < 0) return false;
                }
                return true;
            });

            // Sort
            filtered.sort((a, b) => {
                let va, vb;
                switch (sortState.col) {
                    case 'rank':
                    case 'score': va = getScore(a); vb = getScore(b); break;
                    case 'ticker': va = a.ticker; vb = b.ticker; break;
                    case 'vcp': va = parseFloat(a.vcp_score) || 0; vb = parseFloat(b.vcp_score) || 0; break;
                    case 'insiders': va = parseFloat(a.insiders_score) || 0; vb = parseFloat(b.insiders_score) || 0; break;
                    case 'sector': va = parseFloat(a.sector_score) || 0; vb = parseFloat(b.sector_score) || 0; break;
                    case 'institutional': va = parseFloat(a.institutional_score) || 0; vb = parseFloat(b.institutional_score) || 0; break;
                    case 'upside': va = getUpside(a) ?? -999; vb = getUpside(b) ?? -999; break;
                    case 'whales': va = parseInt(a.num_whales) || 0; vb = parseInt(b.num_whales) || 0; break;
                    case 'earnings': va = parseInt(a.days_to_earnings) || 9999; vb = parseInt(b.days_to_earnings) || 9999; break;
                    default: va = getScore(a); vb = getScore(b);
                }
                if (typeof va === 'string') {
                    return sortState.dir === 'asc' ? va.localeCompare(vb) : vb.localeCompare(va);
                }
                return sortState.dir === 'asc' ? va - vb : vb - va;
            });

            const display = limit > 0 ? filtered.slice(0, limit) : filtered;
            document.getElementById('resultCount').textContent = `Mostrando ${display.length} de ${filtered.length} resultados`;

            displayTable(display);
            updateSortHeaders();
        }

        function updateSortHeaders() {
            document.querySelectorAll('th.sortable').forEach(th => {
                const col = th.dataset.col;
                const icon = th.querySelector('.sort-icon');
                th.classList.toggle('active-sort', col === sortState.col);
                icon.textContent = col === sortState.col ? (sortState.dir === 'asc' ? '‚Üë' : '‚Üì') : '‚Üï';
            });
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') { inQuotes = !inQuotes; }
                else if (char === ',' && !inQuotes) { result.push(current); current = ''; }
                else { current += char; }
            }
            result.push(current);
            return result;
        }

        function displayTable(data) {
            const tbody = document.getElementById('opportunitiesBody');

            tbody.innerHTML = data.map((opp, index) => {
                const score = getScore(opp);
                const vcp = parseFloat(opp.vcp_score) || 0;
                const insiders = parseFloat(opp.insiders_score) || 0;
                const sector = parseFloat(opp.sector_score) || 0;
                const institutional = parseFloat(opp.institutional_score) || 0;
                const numWhales = parseInt(opp.num_whales) || 0;
                const daysToEarnings = opp.days_to_earnings ? parseInt(opp.days_to_earnings) : null;

                const scoreClass = score >= 85 ? 'legendary' :
                                 score >= 75 ? 'epic' :
                                 score >= 65 ? 'excellent' :
                                 score >= 55 ? 'good' : 'moderate';

                // Sector badge
                const sectorName = opp.sector_name || '';
                const sectorMomentum = opp.sector_momentum || '';
                const tierBoost = parseInt(opp.tier_boost) || 0;
                const sectorClass = sectorMomentum === 'improving' ? 'sector-improving' :
                                   sectorMomentum === 'declining' ? 'sector-declining' : 'sector-stable';
                const sectorDisplay = sectorName
                    ? `<span class="badge ${sectorClass}" title="Momentum: ${sectorMomentum} | Boost: +${tierBoost}">${sectorName.length > 16 ? sectorName.slice(0,14) + '‚Ä¶' : sectorName}</span>`
                    : `<span class="dim-badge">${sector.toFixed(0)}</span>`;

                // Target / upside
                const priceTarget = opp.price_target ? parseFloat(opp.price_target) : null;
                const upside = getUpside(opp);
                let targetHTML = '<small style="color: var(--text-secondary);">N/A</small>';
                if (priceTarget && upside !== null) {
                    const upsideClass = upside > 20 ? 'text-success' : upside > 0 ? 'text-info' : 'text-danger';
                    targetHTML = `<div style="font-size: 0.85rem;">
                        <div style="font-weight: 600;">$${priceTarget.toFixed(1)}</div>
                        <div class="${upsideClass}">${upside > 0 ? '+' : ''}${upside.toFixed(1)}%</div>
                    </div>`;
                }

                // Earnings
                let earningsHTML = '<small style="color: var(--text-secondary);">N/A</small>';
                if (daysToEarnings !== null) {
                    if (daysToEarnings >= 0 && daysToEarnings <= 7) {
                        earningsHTML = `<span style="color: #f87171; font-weight: 700;">‚ö†Ô∏è ${daysToEarnings}d</span>`;
                    } else if (daysToEarnings > 0) {
                        earningsHTML = `<small style="color: var(--text-secondary);">${daysToEarnings}d</small>`;
                    }
                }

                // Whales
                const whaleDisplay = numWhales > 0
                    ? `<div style="font-weight: 700;">üêã ${numWhales}</div><div class="whale-info">${(opp.top_whales || '').substring(0, 40)}${(opp.top_whales || '').length > 40 ? '‚Ä¶' : ''}</div>`
                    : '<small style="color: var(--text-secondary);">-</small>';

                return `
                    <tr>
                        <td style="text-align: center; color: var(--text-secondary);">${index + 1}</td>
                        <td class="ticker" style="cursor: pointer;" onclick="window.location.href='stock_detail.html?ticker=${opp.ticker}'" title="Click para ver an√°lisis completo">
                            ${opp.ticker} üîç
                        </td>
                        <td class="score ${scoreClass}">${score.toFixed(1)}</td>
                        <td>${opp.tier}</td>
                        <td><span class="dim-badge">${vcp.toFixed(0)}</span></td>
                        <td><span class="dim-badge">${insiders.toFixed(0)}</span></td>
                        <td>${sectorDisplay}</td>
                        <td><span class="dim-badge">${institutional.toFixed(0)}</span></td>
                        <td style="text-align: center;">${targetHTML}</td>
                        <td>${whaleDisplay}</td>
                        <td style="text-align: center;">${earningsHTML}</td>
                    </tr>
                `;
            }).join('');
        }

        // Event listeners
        document.querySelectorAll('th.sortable').forEach(th => {
            th.addEventListener('click', () => {
                const col = th.dataset.col;
                if (sortState.col === col) {
                    sortState.dir = sortState.dir === 'desc' ? 'asc' : 'desc';
                } else {
                    sortState.col = col;
                    sortState.dir = col === 'ticker' ? 'asc' : 'desc';
                }
                renderTable();
            });
        });

        document.getElementById('scoreFilter').addEventListener('input', e => {
            document.getElementById('scoreValue').textContent = e.target.value;
            renderTable();
        });

        document.getElementById('upsideFilter').addEventListener('change', () => renderTable());
        document.getElementById('limitFilter').addEventListener('change', () => renderTable());

        loadOpportunities();
    </script>
</body>
</html>
